<!DOCTYPE html>
<html>
<head>
    <title>High Resistance Leakage Simulation</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component@1.3.2/dist/aframe-environment-component.min.js"></script>
</head>
<body>

<script>
    // --- PHYSICS LOGIC COMPONENT ---
    AFRAME.registerComponent('lab-logic', {
        schema: {
            capacitance: {type: 'number', default: 10}, // in Microfarads
            initialVoltage: {type: 'number', default: 12} // Volts
        },

        init: function () {
            // Internal Physics State
            this.R = (Math.floor(Math.random() * 5) + 5) * 1000000; // Random R between 5M and 10M Ohms
            this.C = this.data.capacitance * 0.000001; // Convert uF to Farads
            this.V0 = this.data.initialVoltage;
            this.currentV = 0;
            this.timeElapsed = 0;
            this.isCharging = false;
            this.isDischarging = false;
            
            // DOM Elements
            this.voltmeterText = document.querySelector('#voltmeter-display');
            this.timerText = document.querySelector('#timer-display');
            this.statusText = document.querySelector('#status-board');
            this.answerText = document.querySelector('#answer-reveal');

            // Bind interactions
            document.querySelector('#btn-charge').addEventListener('click', () => this.chargeCapacitor());
            document.querySelector('#btn-discharge').addEventListener('click', () => this.startLeakage());
            document.querySelector('#btn-check').addEventListener('click', () => this.revealAnswer());

            // Initial State
            this.updateDisplay();
        },

        tick: function (time, timeDelta) {
            if (this.isDischarging) {
                // Physics: V(t) = V0 * e^(-t / RC)
                let dt = timeDelta / 1000; // delta in seconds
                this.timeElapsed += dt;
                
                // Calculate Voltage Decay
                this.currentV = this.V0 * Math.exp(-this.timeElapsed / (this.R * this.C));
                
                this.updateDisplay();
            }
        },

        chargeCapacitor: function() {
            this.isDischarging = false;
            this.timeElapsed = 0;
            this.currentV = this.V0;
            this.updateDisplay();
            this.statusText.setAttribute('value', "Status: Charged. Ready to Leak.");
            this.answerText.setAttribute('value', "Hidden");
        },

        startLeakage: function() {
            if (this.currentV > 0) {
                this.isDischarging = true;
                this.statusText.setAttribute('value', "Status: Leaking (Measuring...)");
            }
        },

        revealAnswer: function() {
            let rMegaOhms = (this.R / 1000000).toFixed(2);
            this.answerText.setAttribute('value', `True Resistance: ${rMegaOhms} M-Ohms`);
        },

        updateDisplay: function() {
            this.voltmeterText.setAttribute('value', this.currentV.toFixed(2) + " V");
            this.timerText.setAttribute('value', this.timeElapsed.toFixed(1) + " s");
        }
    });
</script>

<a-scene lab-logic cursor="rayOrigin: mouse">
    
    <!-- ENVIRONMENT -->
    <a-entity environment="preset: starry; groundColor: #222; grid: cross"></a-entity>

    <!-- LIGHTING -->
    <a-entity light="type: point; intensity: 0.8; distance: 50; decay: 2" position="0 3 0"></a-entity>
    <a-entity light="type: ambient; color: #BBB"></a-entity>

    <!-- THE LAB BENCH -->
    <a-box position="0 1 -3" width="5" height="0.1" depth="2" color="#333"></a-box>
    
    <!-- INSTRUCTIONAL WHITEBOARD -->
    <a-entity position="0 2.5 -4">
        <a-plane width="6" height="3" color="#FFF"></a-plane>
        <a-text value="High Resistance via Leakage Method" color="#000" position="-2.5 1.2 0.1" width="6"></a-text>
        <a-text value="Formula: R = t / (C * ln(V0 / Vt))" color="#B00" position="-2.5 0.8 0.1" width="5"></a-text>
        <a-text value="1. Click [CHARGE] to set V0 = 12V." color="#333" position="-2.5 0.4 0.1" width="4"></a-text>
        <a-text value="2. Click [START LEAKAGE] to discharge." color="#333" position="-2.5 0.1 0.1" width="4"></a-text>
        <a-text value="3. Record Voltage (Vt) at specific Time (t)." color="#333" position="-2.5 -0.2 0.1" width="4"></a-text>
        <a-text value="4. Calculate R. (C = 10 uF)" color="#333" position="-2.5 -0.5 0.1" width="4"></a-text>
        <a-text id="status-board" value="Status: Ready" color="blue" position="0.5 0.4 0.1" width="5"></a-text>
        <a-text id="answer-reveal" value="" color="green" position="0.5 -0.2 0.1" width="5"></a-text>
    </a-entity>

    <!-- EQUIPMENT GROUP -->
    <a-entity position="0 1 -3">
        
        <!-- Voltmeter -->
        <a-entity position="-1 0.25 0.5">
            <a-box color="#444" width="0.8" height="0.4" depth="0.4"></a-box>
            <a-plane position="0 0 0.21" width="0.7" height="0.3" color="#000"></a-plane>
            <a-text id="voltmeter-display" value="0.00 V" color="red" align="center" position="0 0 0.22" width="4"></a-text>
            <a-text value="VOLTMETER" position="-0.3 0.25 0" width="2" color="#FFF"></a-text>
        </a-entity>

        <!-- Stopwatch -->
        <a-entity position="1 0.25 0.5">
            <a-box color="#444" width="0.8" height="0.4" depth="0.4"></a-box>
            <a-plane position="0 0 0.21" width="0.7" height="0.3" color="#000"></a-plane>
            <a-text id="timer-display" value="0.0 s" color="#0F0" align="center" position="0 0 0.22" width="4"></a-text>
            <a-text value="STOPWATCH" position="-0.3 0.25 0" width="2" color="#FFF"></a-text>
        </a-entity>

        <!-- The Capacitor -->
        <a-cylinder position="-0.5 0.25 -0.5" radius="0.15" height="0.5" color="blue"></a-cylinder>
        <a-text value="C = 10 uF" position="-0.5 0.6 -0.5" align="center" width="3" color="white"></a-text>

        <!-- The Unknown Resistor -->
        <a-box position="0.5 0.1 -0.5" width="0.6" height="0.2" depth="0.2" color="orange"></a-box>
        <a-text value="Unknown R" position="0.5 0.3 -0.5" align="center" width="3" color="white"></a-text>

        <!-- Wires (Visual only) -->
        <a-entity line="start: -1 0.25 0.5; end: -0.5 0.25 -0.5; color: yellow"></a-entity>
        <a-entity line="start: 0.5 0.1 -0.5; end: -0.5 0.25 -0.5; color: yellow"></a-entity>

    </a-entity>

    <!-- INTERACTION BUTTONS -->
    <a-entity position="0 1.1 -2.5">
        
        <!-- Charge Button -->
        <a-entity id="btn-charge" position="-0.8 0 0" geometry="primitive: cylinder; radius: 0.15; height: 0.1" material="color: green"
                  animation__hover="property: scale; to: 1.1 1.1 1.1; startEvents: mouseenter; dur: 200"
                  animation__leave="property: scale; to: 1 1 1; startEvents: mouseleave; dur: 200">
            <a-text value="CHARGE" align="center" position="0 0.1 0" rotation="-90 0 0" width="2" color="white"></a-text>
        </a-entity>

        <!-- Discharge Button -->
        <a-entity id="btn-discharge" position="0 0 0" geometry="primitive: cylinder; radius: 0.15; height: 0.1" material="color: red"
                  animation__hover="property: scale; to: 1.1 1.1 1.1; startEvents: mouseenter; dur: 200"
                  animation__leave="property: scale; to: 1 1 1; startEvents: mouseleave; dur: 200">
            <a-text value="START LEAKAGE" align="center" position="0 0.1 0" rotation="-90 0 0" width="1.8" color="white"></a-text>
        </a-entity>

        <!-- Check Answer Button -->
        <a-entity id="btn-check" position="0.8 0 0" geometry="primitive: box; width: 0.3; depth: 0.3; height: 0.1" material="color: blue"
                  animation__hover="property: scale; to: 1.1 1.1 1.1; startEvents: mouseenter; dur: 200"
                  animation__leave="property: scale; to: 1 1 1; startEvents: mouseleave; dur: 200">
            <a-text value="REVEAL R" align="center" position="0 0.1 0" rotation="-90 0 0" width="1.8" color="white"></a-text>
        </a-entity>
        
    </a-entity>

    <!-- CAMERA -->
    <a-entity position="0 1.6 0">
        <a-camera look-controls wasd-controls>
            <a-cursor color="yellow"></a-cursor>
        </a-camera>
    </a-entity>

</a-scene>

</body>
</html>
